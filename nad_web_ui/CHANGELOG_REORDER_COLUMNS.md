# 修改記錄 - 調整 Top 10 異常 IP 表格欄位順序

**日期**: 2025-11-17
**修改者**: Claude Code
**問題描述**: 表格欄位順序不符合邏輯流程，「分類置信度」應該在「威脅類型」之後

---

## 🎯 修改目的

調整欄位順序以符合資料處理的邏輯流程：

1. **異常檢測** → 平均異常分數（Isolation Forest）
2. **威脅分類** → 威脅類型（Anomaly Classifier）
3. **分類可靠度** → 分類置信度（Classifier Confidence）

---

## 📊 欄位順序調整

### 修改前
```
1. 排名
2. 設備
3. IP 地址
4. 出現次數
5. 平均異常分數    ← Isolation Forest
6. 平均置信度      ← Classifier（位置不對！）
7. 威脅類型        ← Classifier
8. 嚴重性
9. 不同目的地
10. 總流量
11. 操作
```

### 修改後
```
1. 排名
2. 設備
3. IP 地址
4. 出現次數
5. 平均異常分數    ← Isolation Forest（異常檢測）
6. 威脅類型        ← Classifier（威脅分類）
7. 分類置信度      ← Classifier（分類可靠度）✨ 調整到這裡
8. 嚴重性
9. 不同目的地
10. 總流量
11. 操作
```

---

## 🔧 修改內容

**檔案**: `/home/kaisermac/nad_web_ui/frontend/src/views/Dashboard.vue`

### 修改位置：Line 57-113

**主要變更**:
1. ✅ 將「分類置信度」欄位移到「威脅類型」之後
2. ✅ 將欄位名稱從「平均置信度」改為「分類置信度」（更清楚）

---

## 💡 邏輯流程說明

### 完整的異常處理流程

```
┌─────────────────────────────────────────────────────┐
│ 1. 異常檢測階段 - Isolation Forest                   │
├─────────────────────────────────────────────────────┤
│ 輸入: 網路流量特徵（21 個特徵）                      │
│ 輸出: 平均異常分數（0.0 ~ 1.0）                     │
│ 判斷: ≥0.6 → 標記為異常                             │
└─────────────────────────────────────────────────────┘
                         ↓
┌─────────────────────────────────────────────────────┐
│ 2. 威脅分類階段 - Anomaly Classifier                 │
├─────────────────────────────────────────────────────┤
│ 輸入: 異常記錄 + 特徵                                │
│ 輸出: 威脅類型（埠掃描/DDoS/數據外洩...）           │
│ 同時計算: 分類置信度（0% ~ 100%）                   │
└─────────────────────────────────────────────────────┘
```

### 範例說明

**IP: 192.168.10.135**

```
步驟 1: Isolation Forest 檢測
→ 平均異常分數: 0.7845
→ 判斷: 這是異常！（≥0.6）

步驟 2: Anomaly Classifier 分類
→ 威脅類型: 埠掃描
→ 分類置信度: 89%（很確定是埠掃描）

步驟 3: 顯示
→ 嚴重性: HIGH
```

現在表格欄位順序完全符合這個流程！

---

## 📋 欄位名稱變更

### 修改前
- 欄位名稱：**平均置信度**

### 修改後
- 欄位名稱：**分類置信度**

### 變更原因
1. 更明確表達這是「分類器的置信度」
2. 與「平均異常分數」形成對比，避免混淆
3. 簡潔清楚，易於理解

---

## ✅ 優點

### 1. 邏輯更清晰
表格從左到右閱讀時，符合實際的資料處理流程：
- 先看異常分數（是否異常）
- 再看威脅類型（什麼類型）
- 最後看分類置信度（分類可靠嗎）

### 2. 減少混淆
「分類置信度」緊接在「威脅類型」後面，使用者更容易理解兩者的關係

### 3. 符合直覺
使用者思考流程：
1. 這個 IP 有多異常？→ 查看「平均異常分數」
2. 是什麼類型的威脅？→ 查看「威脅類型」
3. 這個分類可靠嗎？→ 查看「分類置信度」

---

## 🧪 視覺化對比

### 修改前（欄位順序混亂）
```
| IP | 異常分數 | 置信度 | 威脅類型 |
|----|---------|--------|---------|
| .1 | 0.7845  | 89%    | 埠掃描   |
     ↑ 第1階段  ↑ 第2階段！ ↑ 第2階段
                (順序錯誤)
```

### 修改後（邏輯順序正確）
```
| IP | 異常分數 | 威脅類型 | 置信度 |
|----|---------|---------|--------|
| .1 | 0.7845  | 埠掃描   | 89%    |
     ↑ 第1階段  ↑ 第2階段  ↑ 第2階段
                (順序正確！)
```

---

## 📝 完整欄位列表

調整後的 Top 10 異常 IP 表格欄位（依序）：

| # | 欄位名稱 | 說明 | 寬度 | 來源 |
|---|---------|------|------|------|
| 1 | 排名 | 1-10 | 60px | 計算 |
| 2 | 設備 | Emoji 圖示 | 60px | Device Classifier |
| 3 | IP 地址 | 來源 IP | 150px | 原始資料 |
| 4 | 出現次數 | 在多少個時段出現 | 100px | 聚合計算 |
| 5 | **平均異常分數** | IF 分數 (0.0-1.0) | 140px | Isolation Forest |
| 6 | **威脅類型** | 分類結果 | 150px | Anomaly Classifier |
| 7 | **分類置信度** | 分類可靠度 (0%-100%) | 140px | Anomaly Classifier |
| 8 | 嚴重性 | HIGH/MEDIUM/LOW | 100px | Threat Classes |
| 9 | 不同目的地 | unique_dsts | 110px | 聚合計算 |
| 10 | 總流量 | 總位元組數 | 110px | 聚合計算 |
| 11 | 操作 | 詳細分析按鈕 | 100px | - |

---

## 🔗 相關修改

這次調整是「修正 Tooltip 說明」的延續改進：
- **前次修改**: 修正 tooltip 說明內容
- **本次修改**: 調整欄位順序，使邏輯更清晰

相關文件：
- `CHANGELOG_FIX_TOOLTIP.md` - Tooltip 說明修正

---

**修改完成時間**: 2025-11-17
**狀態**: ✅ 已完成
