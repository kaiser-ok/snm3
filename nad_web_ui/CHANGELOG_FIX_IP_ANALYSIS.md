# ä¿®æ”¹è¨˜éŒ„ - IP åˆ†æé é¢å„ªåŒ–

**æ—¥æœŸ**: 2025-11-17
**ä¿®æ”¹è€…**: Claude Code
**ä¿®æ”¹æª”æ¡ˆ**: `/home/kaisermac/nad_web_ui/frontend/src/views/IPAnalysis.vue`

---

## ğŸ“‹ ä¿®æ”¹é …ç›®

### 1. ä¿®æ”¹æ¨™é¡Œï¼šã€Œæµé‡çµ±è¨ˆæ‘˜è¦ã€â†’ã€Œç•°å¸¸æµé‡çµ±è¨ˆæ‘˜è¦ã€
### 2. ç§»é™¤ã€ŒTop ç›®çš„åŸ è™Ÿåˆ†ä½ˆã€çš„ã€Œå‰ X åã€æ–‡å­—
### 3. æ’é™¤ port 0 çš„çµ±è¨ˆï¼ˆé TCP/UDP æµé‡ï¼‰
### 4. ä¿®æ­£æ™‚æ®µé¡¯ç¤ºï¼šä½¿ç”¨å¯¦éš›åˆ†ææ™‚é–“ç¯„åœï¼Œè€Œéå›ºå®šã€Œ10åˆ†é˜æ™‚æ®µã€

---

## ğŸ”§ ä¿®æ”¹è©³æƒ…

### ä¿®æ”¹ 1ï¼šæ¨™é¡Œæ›´æ­£ç¢º

**åŸå› **ï¼š
- IP åˆ†æé é¢çš„è³‡æ–™æ˜¯å¾**ç•°å¸¸æª¢æ¸¬å¾Œçš„èšåˆæ•¸æ“š**è¨ˆç®—å‡ºä¾†çš„
- ä¸æ˜¯æ‰€æœ‰æµé‡ï¼Œè€Œæ˜¯è¢«æ¨™è¨˜ç‚ºç•°å¸¸çš„æµé‡
- åŸæ¨™é¡Œã€Œæµé‡çµ±è¨ˆæ‘˜è¦ã€å®¹æ˜“èª¤å°ï¼Œä»¥ç‚ºæ˜¯æ‰€æœ‰æµé‡

**ä¿®æ”¹ä½ç½®**ï¼š
- Line 291ï¼šå¡ç‰‡æ¨™é¡Œ
- Line 611ï¼šPDF å ±å‘Šæ¨™é¡Œ

**ä¿®æ”¹å‰**ï¼š
```vue
æµé‡çµ±è¨ˆæ‘˜è¦
```

**ä¿®æ”¹å¾Œ**ï¼š
```vue
ç•°å¸¸æµé‡çµ±è¨ˆæ‘˜è¦
```

---

### ä¿®æ”¹ 2ï¼šç§»é™¤ã€Œå‰ X åã€æ–‡å­—

**åŸå› **ï¼š
- é¡¯ç¤ºçš„ç­†æ•¸æ˜¯å‹•æ…‹çš„ï¼Œæœƒæ ¹æ“šå¯¦éš›è³‡æ–™é‡è®ŠåŒ–
- ã€Œå‰ X åã€æœƒéš¨è‘—è³‡æ–™è®ŠåŒ–ï¼Œæ²’æœ‰å›ºå®šæ„ç¾©
- ç°¡æ½”çš„æ¨™é¡Œæ›´æ¸…æ¥š

**ä¿®æ”¹ä½ç½®**ï¼š
- Line 404ï¼šå¡ç‰‡æ¨™é¡Œ
- Line 653ï¼šPDF å ±å‘Šæ¨™é¡Œ

**ä¿®æ”¹å‰**ï¼š
```vue
Top ç›®çš„åŸ è™Ÿåˆ†ä½ˆ (å‰ {{ Object.keys(results.details.port_distribution || {}).length }} å)
```

**ä¿®æ”¹å¾Œ**ï¼š
```vue
Top ç›®çš„åŸ è™Ÿåˆ†ä½ˆ
```

---

### ä¿®æ”¹ 3ï¼šæ’é™¤ port 0 çš„çµ±è¨ˆ

**åŸå› **ï¼š
- **Port 0** ä»£è¡¨é TCP/UDP å”å®šçš„æµé‡ï¼ˆå¦‚ ICMPã€GRE ç­‰ï¼‰
- é€™äº›æµé‡æ²’æœ‰ã€Œç›®çš„åŸ è™Ÿã€çš„æ¦‚å¿µ
- å°‡ port 0 ç´å…¥çµ±è¨ˆæœƒèª¤å°ä½¿ç”¨è€…ï¼Œä»¥ç‚ºæœ‰ç•°å¸¸çš„ 0 è™ŸåŸ æµé‡

**ä¿®æ”¹ä½ç½®**ï¼š
- Line 972-987ï¼š`getTopPorts()` å‡½æ•¸

**ä¿®æ”¹å‰**ï¼š
```javascript
function getTopPorts(portDist) {
  if (!portDist) return []
  const total = Object.values(portDist).reduce((sum, count) => sum + count, 0)
  return Object.entries(portDist)
    .map(([port, count]) => ({
      port: port,
      count: count,
      percentage: (count / total) * 100
    }))
    .sort((a, b) => b.count - a.count)
    .slice(0, 20)
}
```

**ä¿®æ”¹å¾Œ**ï¼š
```javascript
function getTopPorts(portDist) {
  if (!portDist) return []

  // æ’é™¤ port 0ï¼ˆé TCP/UDP æµé‡ï¼‰
  const filteredEntries = Object.entries(portDist).filter(([port]) => port !== '0')

  const total = filteredEntries.reduce((sum, [, count]) => sum + count, 0)
  return filteredEntries
    .map(([port, count]) => ({
      port: port,
      count: count,
      percentage: (count / total) * 100
    }))
    .sort((a, b) => b.count - a.count)
    .slice(0, 20)
}
```

**ä¿®æ”¹èªªæ˜**ï¼š
1. ä½¿ç”¨ `filter()` æ’é™¤ port ç‚º '0' çš„é …ç›®
2. åœ¨è¨ˆç®—ç™¾åˆ†æ¯”æ™‚ï¼Œåªè¨ˆç®—éæ¿¾å¾Œçš„ç¸½å’Œ
3. ç¢ºä¿çµ±è¨ˆæ•¸æ“šåªåŒ…å«æœ‰æ„ç¾©çš„ TCP/UDP åŸ è™Ÿ

---

## ğŸ’¡ Port 0 èªªæ˜

### ä»€éº¼æ˜¯ Port 0ï¼Ÿ

åœ¨ç¶²è·¯å”å®šä¸­ï¼ŒPort 0 æœ‰ç‰¹æ®Šæ„ç¾©ï¼š

| å”å®š | Port 0 çš„æ„ç¾© |
|------|--------------|
| **TCP/UDP** | ä¿ç•™ï¼Œä¸æ‡‰ä½¿ç”¨ |
| **å…¶ä»–å”å®š** | è¡¨ç¤ºè©²å”å®šä¸ä½¿ç”¨åŸ è™Ÿæ¦‚å¿µ |

### å“ªäº›æµé‡æœƒæ˜¯ Port 0ï¼Ÿ

å¸¸è¦‹çš„é TCP/UDP å”å®šï¼š

| å”å®šç·¨è™Ÿ | å”å®šåç¨± | èªªæ˜ | Port |
|---------|---------|------|------|
| 1 | ICMP | Internet Control Message Protocolï¼ˆpingï¼‰ | N/A (é¡¯ç¤ºç‚º 0) |
| 2 | IGMP | Internet Group Management Protocol | N/A (é¡¯ç¤ºç‚º 0) |
| 47 | GRE | Generic Routing Encapsulationï¼ˆVPNï¼‰ | N/A (é¡¯ç¤ºç‚º 0) |
| 50 | ESP | Encapsulating Security Payloadï¼ˆIPSecï¼‰ | N/A (é¡¯ç¤ºç‚º 0) |
| 51 | AH | Authentication Headerï¼ˆIPSecï¼‰ | N/A (é¡¯ç¤ºç‚º 0) |

### ç‚ºä»€éº¼è¦æ’é™¤ï¼Ÿ

**ç¯„ä¾‹ï¼šä¿®æ”¹å‰çš„çµ±è¨ˆ**
```
Top ç›®çš„åŸ è™Ÿåˆ†ä½ˆ
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ åŸ è™Ÿ   â”‚ æµé‡æ•¸  â”‚ ç™¾åˆ†æ¯”   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ 0      â”‚ 15,230  â”‚ 45.2%    â”‚  â† èª¤å°ï¼é€™ä¸æ˜¯åŸ è™Ÿ
â”‚ 443    â”‚ 8,542   â”‚ 25.3%    â”‚
â”‚ 80     â”‚ 5,123   â”‚ 15.2%    â”‚
â”‚ 53     â”‚ 4,785   â”‚ 14.2%    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

å•é¡Œï¼š
- âŒ Port 0 å äº† 45%ï¼Œä½†é€™ä¸æ˜¯çœŸæ­£çš„åŸ è™Ÿ
- âŒ ä½¿ç”¨è€…å¯èƒ½èª¤èªç‚ºæœ‰å¤§é‡çš„ç•°å¸¸ 0 è™ŸåŸ æµé‡
- âŒ ç„¡æ³•æ­£ç¢ºåˆ†æ TCP/UDP æœå‹™çš„åˆ†å¸ƒ

**ç¯„ä¾‹ï¼šä¿®æ”¹å¾Œçš„çµ±è¨ˆ**
```
Top ç›®çš„åŸ è™Ÿåˆ†ä½ˆ
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ åŸ è™Ÿ   â”‚ æµé‡æ•¸  â”‚ ç™¾åˆ†æ¯”   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ 443    â”‚ 8,542   â”‚ 46.2%    â”‚  â† æ­£ç¢ºçš„ HTTPS æµé‡
â”‚ 80     â”‚ 5,123   â”‚ 27.7%    â”‚  â† HTTP æµé‡
â”‚ 53     â”‚ 4,785   â”‚ 26.1%    â”‚  â† DNS æµé‡
â””â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
ç¸½è¨ˆ: 18,450ï¼ˆå·²æ’é™¤ 15,230 å€‹ port 0 è¨˜éŒ„ï¼‰
```

å„ªé»ï¼š
- âœ… åªé¡¯ç¤ºæœ‰æ„ç¾©çš„ TCP/UDP åŸ è™Ÿ
- âœ… ç™¾åˆ†æ¯”é‡æ–°è¨ˆç®—ï¼Œæ›´æº–ç¢ºåæ˜ æœå‹™åˆ†å¸ƒ
- âœ… ä½¿ç”¨è€…å¯ä»¥æ­£ç¢ºåˆ¤æ–·ä¸»è¦çš„æœå‹™é¡å‹

---

## ğŸ“Š å½±éŸ¿ç¯„åœ

### å—å½±éŸ¿çš„åŠŸèƒ½
1. âœ… IP åˆ†æé é¢ - æ¨™é¡Œæ›´æº–ç¢º
2. âœ… Top ç›®çš„åŸ è™Ÿåˆ†ä½ˆè¡¨æ ¼ - æ’é™¤ port 0
3. âœ… AI å®‰å…¨å ±å‘Š PDF - æ¨™é¡Œå’Œçµ±è¨ˆæ•¸æ“šåŒæ­¥æ›´æ–°

### ä¸å—å½±éŸ¿çš„åŠŸèƒ½
- âŒ åŸå§‹è³‡æ–™å„²å­˜ï¼ˆport 0 çš„è³‡æ–™ä»ç„¶å­˜åœ¨æ–¼å¾Œç«¯ï¼‰
- âŒ å…¶ä»–é é¢çš„çµ±è¨ˆ

---

## ğŸ§ª æ¸¬è©¦å»ºè­°

### æ¸¬è©¦ 1ï¼šæ¨™é¡Œé¡¯ç¤º
1. å‰å¾€ IP åˆ†æé é¢
2. æª¢æŸ¥å¡ç‰‡æ¨™é¡Œæ˜¯å¦ç‚ºã€Œ**ç•°å¸¸æµé‡çµ±è¨ˆæ‘˜è¦**ã€
3. ç”Ÿæˆ AI å ±å‘Šï¼Œæª¢æŸ¥ PDF ä¸­çš„æ¨™é¡Œ

### æ¸¬è©¦ 2ï¼šPort 0 æ’é™¤
1. é¸æ“‡ä¸€å€‹æœ‰ ICMP æµé‡çš„ IPï¼ˆä¾‹å¦‚ï¼šç¶“å¸¸è¢« ping çš„ä¼ºæœå™¨ï¼‰
2. æŸ¥çœ‹ã€ŒTop ç›®çš„åŸ è™Ÿåˆ†ä½ˆã€
3. **é©—è­‰**ï¼š
   - âœ… è¡¨æ ¼ä¸­**ä¸æ‡‰è©²**å‡ºç¾ port 0
   - âœ… åªé¡¯ç¤ºæœ‰æ„ç¾©çš„ TCP/UDP åŸ è™Ÿï¼ˆå¦‚ï¼š80, 443, 53 ç­‰ï¼‰
   - âœ… ç™¾åˆ†æ¯”ç¸½å’Œæ‡‰æ¥è¿‘ 100%ï¼ˆåªè¨ˆç®— TCP/UDP æµé‡ï¼‰

### æ¸¬è©¦ 3ï¼šå‹•æ…‹æ¨™é¡Œ
1. æŸ¥çœ‹ã€ŒTop ç›®çš„åŸ è™Ÿåˆ†ä½ˆã€
2. **é©—è­‰**ï¼š
   - âœ… æ¨™é¡Œå›ºå®šç‚ºã€ŒTop ç›®çš„åŸ è™Ÿåˆ†ä½ˆã€
   - âœ… æ²’æœ‰ã€Œå‰ X åã€çš„å‹•æ…‹æ–‡å­—

---

## ğŸ” æŠ€è¡“ç´°ç¯€

### Port 0 çš„éæ¿¾é‚è¼¯

```javascript
// åŸå§‹è³‡æ–™
portDist = {
  '0': 15230,    // ICMP æµé‡
  '443': 8542,   // HTTPS
  '80': 5123,    // HTTP
  '53': 4785     // DNS
}

// éæ¿¾ port 0
filteredEntries = [
  ['443', 8542],
  ['80', 5123],
  ['53', 4785]
]

// é‡æ–°è¨ˆç®—ç™¾åˆ†æ¯”
total = 8542 + 5123 + 4785 = 18450
443: 8542 / 18450 = 46.3%
80:  5123 / 18450 = 27.8%
53:  4785 / 18450 = 25.9%
```

### éæ¿¾æ¢ä»¶

```javascript
.filter(([port]) => port !== '0')
```

- æª¢æŸ¥ port çš„å­—ä¸²å€¼æ˜¯å¦ç‚º '0'
- åªæ’é™¤ç²¾ç¢ºåŒ¹é…çš„ '0'ï¼Œä¸å½±éŸ¿å…¶ä»–åŸ è™Ÿ

---

## ğŸ“ ç›¸é—œæª”æ¡ˆ

- **å‰ç«¯**: `/home/kaisermac/nad_web_ui/frontend/src/views/IPAnalysis.vue`
- **å¾Œç«¯**: ä¸éœ€ä¿®æ”¹ï¼ˆè³‡æ–™ä»ä¿ç•™ port 0ï¼‰

---

## ğŸ’­ æœªä¾†è€ƒæ…®

### å¯é¸çš„æ”¹é€²
1. **é¡¯ç¤ºçµ±è¨ˆè³‡è¨Š**ï¼š
   - åœ¨è¡¨æ ¼ä¸‹æ–¹é¡¯ç¤ºã€Œå·²æ’é™¤ X å€‹é TCP/UDP æµé‡è¨˜éŒ„ã€

2. **åˆ†é–‹é¡¯ç¤º**ï¼š
   - å¯ä»¥è€ƒæ…®å¦å¤–é¡¯ç¤ºã€Œé TCP/UDP å”å®šåˆ†å¸ƒã€
   - å¹«åŠ©ä½¿ç”¨è€…äº†è§£å…¶ä»–å”å®šçš„æµé‡ï¼ˆICMPã€GRE ç­‰ï¼‰

3. **å”å®šåˆ†æ**ï¼š
   - åˆ†æ port 0 çš„æµé‡å±¬æ–¼å“ªäº›å”å®š
   - æª¢æ¸¬ç•°å¸¸çš„ ICMP æµé‡ï¼ˆå¦‚ ICMP Floodï¼‰

---

**ä¿®æ”¹å®Œæˆæ™‚é–“**: 2025-11-17
**ç‹€æ…‹**: âœ… å·²å®Œæˆ

---

### ä¿®æ”¹ 4ï¼šä¿®æ­£æ™‚æ®µé¡¯ç¤ºé‚è¼¯

**åŸå› **ï¼š
- åŸæœ¬çš„ `formatDetectionTimeRange()` å‡½æ•¸**ç¡¬ç·¨ç¢¼äº† 10 åˆ†é˜**
- ç„¡è«–å¯¦éš›åˆ†æå¤šé•·æ™‚é–“ï¼Œæ°¸é é¡¯ç¤ºã€Œ10åˆ†é˜æ™‚æ®µã€
- èˆ‡å¯¦éš›åˆ†ææ™‚é–“ç¯„åœä¸ç¬¦

**ä¿®æ”¹ä½ç½®**ï¼š
- Line 1121-1168ï¼š`formatDetectionTimeRange()` å‡½æ•¸

**ä¿®æ”¹å‰**ï¼š
```javascript
function formatDetectionTimeRange(isoTime) {
  if (!isoTime) return ''
  const startTime = new Date(isoTime)
  const endTime = new Date(startTime.getTime() + 10 * 60 * 1000) // âŒ ç¡¬ç·¨ç¢¼ 10 åˆ†é˜

  const formatTime = (date) => { /* ... */ }

  return `10åˆ†é˜æ™‚æ®µ: ${formatTime(startTime)} ~ ${formatTime(endTime)}`
}
```

**ä¿®æ”¹å¾Œ**ï¼š
```javascript
function formatDetectionTimeRange(isoTime) {
  if (!isoTime) return ''

  // âœ… ä½¿ç”¨å¯¦éš›çš„åˆ†ææ™‚é–“ç¯„åœ
  if (results.value?.time_range) {
    const startTime = new Date(results.value.time_range.start)
    const endTime = new Date(results.value.time_range.end)
    const durationMinutes = results.value.time_range.duration_minutes || 0

    const formatTime = (date) => { /* ... */ }

    // âœ… æ ¹æ“šæ™‚é–“é•·åº¦é¡¯ç¤ºä¸åŒçš„æ¨™ç±¤
    let label = 'åˆ†ææ™‚æ®µ'
    if (durationMinutes <= 10) {
      label = `${durationMinutes}åˆ†é˜æ™‚æ®µ`
    } else if (durationMinutes < 60) {
      label = `${durationMinutes}åˆ†é˜æ™‚æ®µ`
    } else if (durationMinutes < 1440) {
      label = `${Math.round(durationMinutes / 60)}å°æ™‚æ™‚æ®µ`
    } else {
      label = `${Math.round(durationMinutes / 1440)}å¤©æ™‚æ®µ`
    }

    return `${label}: ${formatTime(startTime)} ~ ${formatTime(endTime)}`
  }

  // å‚™ç”¨é‚è¼¯ï¼ˆå¦‚æœæ²’æœ‰ time_range è³‡è¨Šï¼‰
  // ...
}
```

**é¡¯ç¤ºæ•ˆæœ**ï¼š

| åˆ†ææ™‚é–“ç¯„åœ | ä¿®æ”¹å‰é¡¯ç¤º | ä¿®æ”¹å¾Œé¡¯ç¤º |
|-------------|-----------|-----------|
| 5 åˆ†é˜ | âŒ 10åˆ†é˜æ™‚æ®µ: ... | âœ… 5åˆ†é˜æ™‚æ®µ: ... |
| 10 åˆ†é˜ | âœ… 10åˆ†é˜æ™‚æ®µ: ... | âœ… 10åˆ†é˜æ™‚æ®µ: ... |
| 30 åˆ†é˜ | âŒ 10åˆ†é˜æ™‚æ®µ: ... | âœ… 30åˆ†é˜æ™‚æ®µ: ... |
| 1 å°æ™‚ | âŒ 10åˆ†é˜æ™‚æ®µ: ... | âœ… 1å°æ™‚æ™‚æ®µ: ... |
| 24 å°æ™‚ | âŒ 10åˆ†é˜æ™‚æ®µ: ... | âœ… 24å°æ™‚æ™‚æ®µ: ... |
| 2 å¤© | âŒ 10åˆ†é˜æ™‚æ®µ: ... | âœ… 2å¤©æ™‚æ®µ: ... |

---

## ğŸ¯ ä¿®æ”¹ç¸½çµ

| # | ä¿®æ”¹é …ç›® | ä½ç½® | ç‹€æ…‹ |
|---|---------|------|------|
| 1 | æ¨™é¡Œæ”¹ç‚ºã€Œç•°å¸¸æµé‡çµ±è¨ˆæ‘˜è¦ã€ | Line 291, 611 | âœ… å®Œæˆ |
| 2 | ç§»é™¤ã€Œå‰ X åã€æ–‡å­— | Line 404, 653 | âœ… å®Œæˆ |
| 3 | æ’é™¤ port 0 çµ±è¨ˆ | Line 972-987 | âœ… å®Œæˆ |
| 4 | ä¿®æ­£æ™‚æ®µé¡¯ç¤º | Line 1121-1168 | âœ… å®Œæˆ |

