# 網路流量異常分析報告

**分析時間:** 2025-11-11 11:59:32
**分析區間:** 過去1小時
**資料來源:** ElasticSearch (radar_flow_collector-2025.11.11)

---

## 執行摘要

過去1小時內，網路流量總計約 **50+ GB**，總封包數達 **5,550萬個**，總連線數為 **182萬次**。分析發現多項異常情況，包括：

- ⚠️ **20個異常高流量連線** (單一連線超過100MB)
- ⚠️ **100個異常高連線數IP** (單一IP超過1000個連線)
- ⚠️ **28個可疑掃描行為IP** (高連線數但低流量)

---

## 1. 流量總覽

| 指標 | 數值 |
|------|------|
| 總流量 | ~50+ GB |
| 總封包數 | 55,536,628 |
| 總連線數 | 1,825,780 |
| 主要協定 | TCP (37.7 GB, 75%), UDP (12.7 GB, 25%) |

---

## 2. Top 10 流量來源 IP 分析

### 前三名異常流量來源：

1. **199.232.214.172**
   - 流量: 5,392.21 MB
   - 封包數: 3,801,504
   - 連線數: 1,095
   - **評估:** 外部IP，流量巨大，建議調查用途

2. **199.232.210.172**
   - 流量: 4,789.76 MB
   - 封包數: 3,377,601
   - 連線數: 1,101
   - **評估:** 外部IP，與上一個IP模式類似，可能是CDN或雲端服務

3. **118.160.68.239**
   - 流量: 3,606.85 MB
   - 封包數: 2,926,932
   - 連線數: 780
   - **評估:** 外部IP，高流量來源

### 內部網路高流量設備：

4. **192.168.10.254** (Gateway/路由器)
   - 流量: 3,283.07 MB
   - 連線數: 2,650
   - **評估:** 正常網關流量

5. **192.168.20.141**
   - 流量: 2,465.64 MB
   - 連線數: 1,485
   - **評估:** 內部伺服器或工作站，流量集中在少數目的地

6. **192.168.50.30**
   - 流量: 1,266.22 MB
   - 連線數: 6,622
   - **評估:** 高連線數，可能是應用伺服器

---

## 3. Top 10 流量目的 IP 分析

### 最大流量接收者：

1. **118.163.8.90** (已識別為「公司內部」)
   - 接收流量: **23,883.50 MB** (約23.9 GB)
   - 接收封包數: 22,061,287
   - 連線數: 507,474
   - **⚠️ 嚴重異常:** 此IP是過去1小時最大的流量接收者，佔總流量近50%
   - **建議:** 立即調查此IP的服務內容和流量來源

2. **192.168.10.26**
   - 接收流量: 3,269.69 MB
   - 連線數: 1,807

3. **192.168.50.30**
   - 接收流量: 1,900.74 MB
   - 連線數: 3,115

---

## 4. 異常高流量連線分析 (單一連線 > 100MB)

發現 **20個** 單一連線流量超過100MB的異常情況：

### Top 5 異常高流量連線：

| 時間 | 來源IP | 目的IP:Port | 流量(MB) | 封包數 | 協定 |
|------|--------|-------------|----------|--------|------|
| 11:32:59 | 192.168.10.134 | 192.168.20.124:34416 | 547.42 | 186,519 | TCP |
| 11:03:52 | N/A | N/A:63430 | 328.98 | 28,785 | TCP |
| 11:03:46 | N/A | N/A:63430 | 235.16 | 20,379 | TCP |
| 11:03:20 | 192.168.20.141 | 192.168.50.30:50381 | 233.22 | 162,663 | TCP |
| 11:03:48 | N/A | N/A:63430 | 226.64 | 19,464 | TCP |

### 關鍵發現：

- **192.168.10.134 → 192.168.20.124** 單一連線傳輸547MB，極度異常
- **172.64.66.1 → 118.163.8.90** 多次大流量連線到「公司內部」IP
- **Port 63430** 出現多次，需調查此端口用途
- 部分連線來源IP顯示為 N/A，可能是資料收集問題

**建議行動:**
1. 調查 192.168.10.134 和 192.168.20.124 之間的大量資料傳輸
2. 確認 Port 63430 的服務類型
3. 檢查為何部分流量的來源IP無法識別

---

## 5. 異常高連線數 IP 分析 (單一IP > 1000連線)

發現 **100個** IP在1小時內產生超過1000個連線。

### Top 10 高連線數IP：

| 排名 | IP | 連線數 | 流量(MB) | 不同目的地數 | 異常程度 |
|------|-----|--------|----------|-------------|----------|
| 1 | **192.168.10.135** | 510,823 | 180.10 | 107 | 🔴 極高 |
| 2 | **192.168.20.56** | 394,143 | 140.22 | 29 | 🔴 極高 |
| 3 | **8.8.8.8** | 276,145 | 217.81 | 1 | 🟡 中等 |
| 4 | 192.168.10.160 | 33,826 | 57.07 | 80 | 🟡 中等 |
| 5 | 192.168.20.30 | 28,712 | 27.08 | 30 | 🟡 中等 |
| 6 | 203.72.154.50 | 11,973 | 842.90 | 1 | 🟢 低 |
| 7 | 192.168.0.4 | 11,081 | 9.83 | 5 | 🟡 中等 |
| 8 | 192.168.10.134 | 11,034 | 808.82 | 17 | 🟡 中等 |
| 9 | 192.168.70.26 | 9,838 | 15.28 | 156 | 🟡 中等 |
| 10 | 192.168.30.32 | 9,750 | 27.36 | 60 | 🟡 中等 |

### 異常分析：

#### 🔴 **192.168.10.135** - 極度異常
- **連線數:** 510,823 (過去1小時)
- **平均每秒:** 142次連線
- **流量:** 180 MB (相對連線數較小)
- **目的地數量:** 107個不同IP
- **評估:** 疑似掃描行為或異常應用程式，建議立即調查

#### 🔴 **192.168.20.56** - 極度異常
- **連線數:** 394,143
- **平均每秒:** 109次連線
- **流量:** 140 MB
- **目的地數量:** 29個不同IP
- **評估:** 高連線數對少數目的地，可能是頻繁輪詢或異常應用

#### 🟡 **8.8.8.8** (Google DNS) - 中等異常
- **連線數:** 276,145
- **流量:** 217.81 MB
- **目的地數量:** 1
- **評估:** 作為DNS來源的連線數過高，可能有設備配置問題或DNS查詢異常

---

## 6. 可疑掃描行為分析

發現 **28個** IP具有典型的掃描行為特徵（高連線數、多目的地、低流量）。

### Top 10 可疑掃描IP：

| IP | 連線數 | 不同目的地 | 平均流量/連線 | 總流量 | 風險等級 |
|----|--------|-----------|--------------|--------|---------|
| **192.168.10.135** | 510,823 | 107 | 0.36 KB | 180 MB | 🔴 高 |
| 192.168.10.160 | 33,826 | 80 | 1.73 KB | 57 MB | 🟡 中 |
| 192.168.70.26 | 9,838 | 156 | 1.59 KB | 15 MB | 🟡 中 |
| 192.168.30.32 | 9,750 | 60 | 2.87 KB | 27 MB | 🟡 中 |
| **192.168.20.50** | 9,404 | 774 | 2.26 KB | 21 MB | 🔴 高 |
| 192.168.70.54 | 9,165 | 280 | 7.03 KB | 63 MB | 🟡 中 |
| 192.168.50.6 | 8,229 | 108 | 2.61 KB | 21 MB | 🟡 中 |
| 192.168.50.7 | 7,969 | 171 | 4.64 KB | 36 MB | 🟡 中 |
| 192.168.70.48 | 7,920 | 138 | 2.98 KB | 23 MB | 🟡 中 |
| 192.168.50.5 | 7,454 | 144 | 5.82 KB | 42 MB | 🟡 中 |

### 掃描行為特徵：

1. **192.168.10.135** - 最可疑
   - 平均每個連線僅 **0.36 KB**
   - 連線到107個不同目的地
   - 超過51萬次連線
   - **建議:** 隔離此設備並進行安全檢查

2. **192.168.20.50** - 廣泛掃描
   - 連線到 **774個** 不同目的地
   - 典型的網路掃描模式
   - **建議:** 檢查此設備是否為安全掃描工具或受感染設備

---

## 7. 協定分布分析

| 協定 | 協定號 | 流量(MB) | 百分比 | 說明 |
|------|--------|----------|--------|------|
| TCP | 6 | 37,740.66 | 75% | 正常，大部分網路流量 |
| UDP | 17 | 12,660.57 | 25% | 正常，DNS、視訊等 |
| ICMPv6 | 58 | 9.73 | <0.1% | 正常，IPv6相關 |
| ICMP | 1 | 4.57 | <0.1% | 正常，Ping等 |

協定分布正常，TCP和UDP佔主要流量。

---

## 8. 威脅評估與建議

### 🔴 **高優先級異常 (需立即處理)**

1. **192.168.10.135** - 極度異常掃描行為
   - **現象:** 1小時內51萬次連線，平均每連線0.36KB
   - **風險:** 可能是惡意掃描、蠕蟲或受感染設備
   - **建議:**
     - 立即隔離此IP
     - 檢查設備是否受感染
     - 查看此設備的用戶和用途

2. **118.163.8.90** (公司內部) - 異常大流量接收
   - **現象:** 接收23.9GB流量，佔總流量近50%
   - **風險:** 可能是資料外洩、DDoS目標或大量下載
   - **建議:**
     - 確認此IP的服務內容
     - 分析流量來源的合法性
     - 檢查是否為資料外洩

3. **192.168.20.56** - 極高連線數
   - **現象:** 39萬次連線到29個目的地
   - **風險:** 異常應用或受感染設備
   - **建議:**
     - 調查設備類型和運行的應用
     - 檢查是否為自動化工具或惡意軟體

### 🟡 **中優先級異常 (需調查)**

4. **外部IP大流量 (199.232.x.x, 118.160.68.239)**
   - **建議:** 確認這些外部連線的業務合理性

5. **192.168.10.134 → 192.168.20.124** - 單一連線547MB
   - **建議:** 確認是否為合法的大檔案傳輸

6. **192.168.20.50** - 掃描774個目的地
   - **建議:** 確認是否為授權的安全掃描工具

### 🟢 **正常但需監控**

7. **8.8.8.8 (Google DNS)** - 27萬次連線
   - **建議:** 檢查DNS查詢頻率是否正常

---

## 9. 行動建議

### 立即行動 (0-2小時)
1. ✅ 隔離並調查 **192.168.10.135**
2. ✅ 確認 **118.163.8.90** 的服務和流量合法性
3. ✅ 調查 **192.168.20.56** 的異常連線行為

### 短期行動 (2-24小時)
4. 🔍 分析 Port 63430 的服務用途
5. 🔍 確認外部IP (199.232.x.x) 的連線目的
6. 🔍 檢查 192.168.10.134 ↔ 192.168.20.124 的大量傳輸
7. 🔍 調查 192.168.20.50 的掃描行為

### 中期行動 (1-7天)
8. 📊 建立基準線流量模型
9. 📊 設置異常流量告警規則
10. 📊 定期監控高連線數設備

---

## 10. 附錄：詳細數據查詢

分析腳本已保存在：`/home/kaisermac/snm_flow/analyze_traffic.sh`

可執行以下命令重新分析：
```bash
cd /home/kaisermac/snm_flow
./analyze_traffic.sh
```

---

**報告生成時間:** 2025-11-11 12:00:00
**分析工具:** ElasticSearch 7.17.28 + 自訂分析腳本
**資料完整性:** ✓ 正常
